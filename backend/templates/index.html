<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard √âconomique d'Alg√©rie</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-buttons {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .nav-buttons a {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .nav-buttons a:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .nav-buttons a.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .subtitle {
            color: #95a5a6;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .chart-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .chart-card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .chart-card p {
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.5em;
        }

        .info-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .info-box h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        th, td {
            padding: 15px;
            text-align: left;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e8eaf6;
        }

        .positive {
            color: #27ae60;
            font-weight: bold;
        }

        .negative {
            color: #e74c3c;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .nav-buttons a {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard √âconomique d'Alg√©rie</h1>
            <p id="pageSubtitle">Analyse de la croissance du PIB, Inflation et Prix du P√©trole</p>
            <p style="font-size: 0.9em; color: #95a5a6; margin-top: 10px;">
                Sources: Banque d'Alg√©rie, ONS, OPEC
            </p>
            <div class="nav-buttons">
                <a href="javascript:void(0)" onclick="loadPage('vue-ensemble')" class="active" id="nav-vue">üìä Vue d'Ensemble</a>
                <a href="javascript:void(0)" onclick="loadPage('pib')" id="nav-pib">üìà PIB</a>
                <a href="javascript:void(0)" onclick="loadPage('inflation')" id="nav-inflation">üí∞ Inflation</a>
                <a href="javascript:void(0)" onclick="loadPage('petrole')" id="nav-petrole">üõ¢Ô∏è P√©trole</a>
                <a href="javascript:void(0)" onclick="loadPage('analyse')" id="nav-analyse">üî¨ Analyse</a>
            </div>
        </div>

        <div id="loading" class="loading">‚è≥ Chargement des donn√©es...</div>
        <div id="content"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <script>
        console.log('üöÄ Dashboard d√©marr√©');

        let currentData = { pib: null, inflation: null, opec: null };
        let chartInstances = {};

        function destroyChart(chartId) {
            if (chartInstances[chartId]) {
                try {
                    chartInstances[chartId].destroy();
                    delete chartInstances[chartId];
                } catch(e) {
                    console.error('Erreur destruction:', e);
                }
            }
        }

        function destroyAllCharts() {
            Object.keys(chartInstances).forEach(id => destroyChart(id));
        }

        async function loadAllData() {
            try {
                console.log('üì° Chargement des donn√©es...');
                
                const [pibResp, inflationResp, opecResp] = await Promise.all([
                    fetch('/api/query/croissance-pib'),
                    fetch('/api/query/inflation'),
                    fetch('/api/query/opec')
                ]);

                if (!pibResp.ok || !inflationResp.ok || !opecResp.ok) {
                    throw new Error('Erreur r√©ponse API');
                }

                currentData.pib = await pibResp.json();
                currentData.inflation = await inflationResp.json();
                currentData.opec = await opecResp.json();

                console.log('‚úÖ Donn√©es charg√©es');
                return true;
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                return false;
            }
        }

        function loadPage(page) {
            console.log('üìÑ Page:', page);
            
            destroyAllCharts();
            
            document.querySelectorAll('.nav-buttons a').forEach(a => a.classList.remove('active'));
            const navBtn = document.getElementById(`nav-${page}`);
            if (navBtn) navBtn.classList.add('active');

            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').innerHTML = '';

            setTimeout(() => {
                try {
                    switch(page) {
                        case 'vue-ensemble': renderVueEnsemble(); break;
                        case 'pib': renderPIB(); break;
                        case 'inflation': renderInflation(); break;
                        case 'petrole': renderPetrole(); break;
                        case 'analyse': renderAnalyse(); break;
                        default: document.getElementById('content').innerHTML = '<div class="info-box"><h2>‚ùå Page non trouv√©e</h2></div>';
                    }
                } catch(e) {
                    console.error('‚ùå Erreur:', e);
                    document.getElementById('content').innerHTML = `<div class="info-box"><h2>‚ùå Erreur: ${e.message}</h2></div>`;
                }
                document.getElementById('loading').style.display = 'none';
            }, 300);
        }

        function calculateStats(values) {
            if (!values || values.length === 0) {
                return { moyenne: 0, max: 0, min: 0, last: 0 };
            }
            return {
                moyenne: values.reduce((a,b) => a+b, 0) / values.length,
                max: Math.max(...values),
                min: Math.min(...values),
                last: values[values.length - 1]
            };
        }

        function normalize(arr) {
            const min = Math.min(...arr);
            const max = Math.max(...arr);
            if (max === min) return arr.map(() => 50);
            return arr.map(v => ((v - min) / (max - min)) * 100);
        }

        function createChart(canvasId, config) {
            try {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error('‚ùå Canvas non trouv√©:', canvasId);
                    return null;
                }

                const ctx = canvas.getContext('2d');
                destroyChart(canvasId);

                chartInstances[canvasId] = new Chart(ctx, config);
                console.log('‚úÖ Graphique cr√©√©:', canvasId);
                return chartInstances[canvasId];
            } catch(e) {
                console.error('‚ùå Erreur graphique:', canvasId, e);
                return null;
            }
        }

        // ===== PAGE 1: VUE D'ENSEMBLE =====
        function renderVueEnsemble() {
            document.getElementById('pageSubtitle').textContent = 
                'Analyse de la croissance du PIB, Inflation et Prix du P√©trole';

            const { pib, inflation, opec } = currentData;

            document.getElementById('content').innerHTML = `
                <div class="info-box">
                    <h2>üéØ Bienvenue sur le Dashboard √âconomique</h2>
                    <p>Ce dashboard pr√©sente les principaux indicateurs √©conomiques de l'Alg√©rie : la croissance du PIB, 
                    l'√©volution de l'inflation (IPC), et les prix du p√©trole (OPEC Basket).</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>üìà Croissance du PIB</h3>
                        <div class="value">${pib.valeurs[pib.valeurs.length-1].toFixed(2)}%</div>
                        <div class="subtitle">Derni√®re ann√©e (${pib.annees[pib.annees.length-1]})</div>
                    </div>
                    <div class="stat-card">
                        <h3>üí∞ Inflation (IPC)</h3>
                        <div class="value">${inflation.valeurs[inflation.valeurs.length-1].toFixed(2)}%</div>
                        <div class="subtitle">Taux actuel (${inflation.annees[inflation.annees.length-1]})</div>
                    </div>
                    <div class="stat-card">
                        <h3>üõ¢Ô∏è Prix P√©trole</h3>
                        <div class="value">$${opec.valeurs[opec.valeurs.length-1].toFixed(2)}</div>
                        <div class="subtitle">Prix OPEC (${opec.annees[opec.annees.length-1]})</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìÖ P√©riode</h3>
                        <div class="value">${Math.min(...pib.annees.map(a => parseInt(a)))}-${Math.max(...pib.annees.map(a => parseInt(a)))}</div>
                        <div class="subtitle">${pib.annees.length} ann√©es</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìä Question 1: √âvolution Comparative des Indicateurs</h2>
                    <p>Comment les trois indicateurs √©conomiques ont-ils √©volu√© ensemble au fil du temps ?</p>
                    <div class="chart-container">
                        <canvas id="overviewChart"></canvas>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const commonYears = pib.annees.filter(y => 
                    inflation.annees.includes(y) && opec.annees.includes(y)
                );

                const pibData = commonYears.map(y => pib.valeurs[pib.annees.indexOf(y)]);
                const inflData = commonYears.map(y => inflation.valeurs[inflation.annees.indexOf(y)]);
                const opecData = commonYears.map(y => opec.valeurs[opec.annees.indexOf(y)]);

                createChart('overviewChart', {
                    type: 'line',
                    data: {
                        labels: commonYears,
                        datasets: [
                            {
                                label: 'PIB (normalis√©)',
                                data: normalize(pibData),
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Inflation (normalis√©)',
                                data: normalize(inflData),
                                borderColor: '#f5576c',
                                backgroundColor: 'rgba(245, 87, 108, 0.1)',
                                borderWidth: 3,
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'P√©trole (normalis√©)',
                                data: normalize(opecData),
                                borderColor: '#43e97b',
                                backgroundColor: 'rgba(67, 233, 123, 0.1)',
                                borderWidth: 3,
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            x: { ticks: { maxRotation: 45, minRotation: 45 }},
                            y: { beginAtZero: true, max: 100 }
                        }
                    }
                });
            }, 100);
        }

        // ===== PAGE 2: PIB =====
        function renderPIB() {
            document.getElementById('pageSubtitle').textContent = 
                'Analyse de la croissance du Produit Int√©rieur Brut';

            const { pib } = currentData;
            const stats = calculateStats(pib.valeurs);

            document.getElementById('content').innerHTML = `
                <div class="info-box">
                    <h2>üìà Question 2: Comment √©volue le PIB en Alg√©rie ?</h2>
                    <p>Analyse de l'√©volution de la croissance du PIB. Une croissance positive indique une expansion √©conomique.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>üìä Croissance Moyenne</h3>
                        <div class="value">${stats.moyenne.toFixed(2)}%</div>
                        <div class="subtitle">Sur toute la p√©riode</div>
                    </div>
                    <div class="stat-card">
                        <h3>‚¨ÜÔ∏è Maximum</h3>
                        <div class="value">${stats.max.toFixed(2)}%</div>
                        <div class="subtitle">Plus forte croissance</div>
                    </div>
                    <div class="stat-card">
                        <h3>‚¨áÔ∏è Minimum</h3>
                        <div class="value">${stats.min.toFixed(2)}%</div>
                        <div class="subtitle">Plus faible croissance</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìÖ Derni√®re Ann√©e</h3>
                        <div class="value">${stats.last.toFixed(2)}%</div>
                        <div class="subtitle">${pib.annees[pib.annees.length-1]}</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìà √âvolution de la Croissance du PIB (${pib.annees[0]} - ${pib.annees[pib.annees.length-1]})</h2>
                    <div class="chart-container">
                        <canvas id="pibChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìä Comparaison par P√©riode</h2>
                    <div class="chart-container">
                        <canvas id="pibBarChart"></canvas>
                    </div>
                </div>
            `;

            setTimeout(() => {
                createChart('pibChart', {
                    type: 'line',
                    data: {
                        labels: pib.annees,
                        datasets: [{
                            label: 'Croissance du PIB (%)',
                            data: pib.valeurs,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { ticks: { callback: (value) => value.toFixed(1) + '%' }}
                        }
                    }
                });

                const periods = { '2002-2009': [], '2010-2019': [], '2020-2025': [] };
                pib.annees.forEach((annee, idx) => {
                    const year = parseInt(annee);
                    if (year <= 2009) periods['2002-2009'].push(pib.valeurs[idx]);
                    else if (year <= 2019) periods['2010-2019'].push(pib.valeurs[idx]);
                    else periods['2020-2025'].push(pib.valeurs[idx]);
                });

                const avgPeriods = Object.keys(periods).map(p => 
                    periods[p].length > 0 ? periods[p].reduce((a,b) => a+b, 0) / periods[p].length : 0
                );

                createChart('pibBarChart', {
                    type: 'bar',
                    data: {
                        labels: Object.keys(periods),
                        datasets: [{
                            label: 'Croissance moyenne (%)',
                            data: avgPeriods,
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }}
                    }
                });
            }, 100);
        }

        // ===== PAGE 3: INFLATION =====
        function renderInflation() {
            const { inflation } = currentData;
            const stats = calculateStats(inflation.valeurs);

            document.getElementById('content').innerHTML = `
                <div class="info-box">
                    <h2>üí∞ Question 3: Quelle est l'√©volution de l'inflation en Alg√©rie ?</h2>
                    <p>L'inflation mesure l'augmentation des prix. Un taux √©lev√© r√©duit le pouvoir d'achat.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>üìä Moyenne</h3>
                        <div class="value">${stats.moyenne.toFixed(2)}%</div>
                        <div class="subtitle">Sur toute la p√©riode</div>
                    </div>
                    <div class="stat-card">
                        <h3>üî• Maximum</h3>
                        <div class="value">${stats.max.toFixed(2)}%</div>
                        <div class="subtitle">Pic d'inflation</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìâ Minimum</h3>
                        <div class="value">${stats.min.toFixed(2)}%</div>
                        <div class="subtitle">Plus bas niveau</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìÖ Actuel</h3>
                        <div class="value">${stats.last.toFixed(2)}%</div>
                        <div class="subtitle">${inflation.annees[inflation.annees.length-1]}</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üí∞ √âvolution de l'Inflation (IPC)</h2>
                    <div class="chart-container">
                        <canvas id="inflationChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üîç Inflation pendant les Crises</h2>
                    <div class="chart-container">
                        <canvas id="crisisChart"></canvas>
                    </div>
                </div>
            `;

            setTimeout(() => {
                createChart('inflationChart', {
                    type: 'line',
                    data: {
                        labels: inflation.annees,
                        datasets: [{
                            label: 'Inflation (%)',
                            data: inflation.valeurs,
                            borderColor: '#f5576c',
                            backgroundColor: 'rgba(245, 87, 108, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                const crisisYears = ['2008', '2020', '2022', '2023'];
                const crisisData = crisisYears.map(year => {
                    const idx = inflation.annees.indexOf(year);
                    return idx !== -1 ? inflation.valeurs[idx] : 0;
                });

                createChart('crisisChart', {
                    type: 'bar',
                    data: {
                        labels: ['Crise 2008', 'COVID 2020', 'Ukraine 2022', 'Post 2023'],
                        datasets: [{
                            label: 'Inflation (%)',
                            data: crisisData,
                            backgroundColor: ['#f093fb', '#ffd93d', '#ff6b6b', '#f5576c']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }}
                    }
                });
            }, 100);
        }

        // ===== PAGE 4: P√âTROLE (SIMPLIFI√â) =====
        function renderPetrole() {
            const { opec } = currentData;
            const stats = calculateStats(opec.valeurs);

            document.getElementById('content').innerHTML = `
                <div class="info-box">
                    <h2>üõ¢Ô∏è Question 4: Comment le prix du p√©trole √©volue-il en Alg√©rie ?</h2>
                    <p>Le prix du p√©trole est crucial pour l'√©conomie alg√©rienne. Les recettes p√©troli√®res constituent 
                    la principale source de revenus de l'√âtat.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>üí∞ Prix Moyen</h3>
                        <div class="value">$${stats.moyenne.toFixed(2)}</div>
                        <div class="subtitle">Sur ${opec.annees.length} ann√©es</div>
                    </div>
                    <div class="stat-card">
                        <h3>‚¨ÜÔ∏è Maximum</h3>
                        <div class="value">$${stats.max.toFixed(2)}</div>
                        <div class="subtitle">Plus haut historique</div>
                    </div>
                    <div class="stat-card">
                        <h3>‚¨áÔ∏è Minimum</h3>
                        <div class="value">$${stats.min.toFixed(2)}</div>
                        <div class="subtitle">Plus bas historique</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìÖ Prix Actuel</h3>
                        <div class="value">$${stats.last.toFixed(2)}</div>
                        <div class="subtitle">${opec.annees[opec.annees.length-1]}</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìà √âvolution du Prix du P√©trole (OPEC Basket)</h2>
                    <p>Prix moyen annuel du panier OPEC de ${opec.annees[0]} √† ${opec.annees[opec.annees.length-1]}</p>
                    <div class="chart-container">
                        <canvas id="opecChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìä Comparaison par P√©riode</h2>
                    <p>Prix moyen du p√©trole par d√©cennie</p>
                    <div class="chart-container">
                        <canvas id="opecBarChart"></canvas>
                    </div>
                </div>
            `;

            setTimeout(() => {
                // Graphique 1: √âvolution
                createChart('opecChart', {
                    type: 'line',
                    data: {
                        labels: opec.annees,
                        datasets: [{
                            label: 'Prix OPEC ($/baril)',
                            data: opec.valeurs,
                            borderColor: '#43e97b',
                            backgroundColor: 'rgba(67, 233, 123, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { 
                            y: { ticks: { callback: (value) => '$' + value.toFixed(0) }}
                        }
                    }
                });

                // Graphique 2: Par p√©riode
                const periods = { '2003-2009': [], '2010-2014': [], '2015-2019': [], '2020-2025': [] };
                opec.annees.forEach((annee, idx) => {
                    const year = parseInt(annee);
                    if (year <= 2009) periods['2003-2009'].push(opec.valeurs[idx]);
                    else if (year <= 2014) periods['2010-2014'].push(opec.valeurs[idx]);
                    else if (year <= 2019) periods['2015-2019'].push(opec.valeurs[idx]);
                    else periods['2020-2025'].push(opec.valeurs[idx]);
                });

                const avgPeriods = Object.keys(periods).map(p => 
                    periods[p].length > 0 ? periods[p].reduce((a,b) => a+b, 0) / periods[p].length : 0
                );

                createChart('opecBarChart', {
                    type: 'bar',
                    data: {
                        labels: Object.keys(periods),
                        datasets: [{
                            label: 'Prix moyen ($/baril)',
                            data: avgPeriods,
                            backgroundColor: ['#43e97b', '#51cf66', '#94d82d', '#ffd93d']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }},
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { callback: (value) => '$' + value.toFixed(0) }
                            }
                        }
                    }
                });
            }, 100);
        }

        // ===== PAGE 5: ANALYSE =====
        function renderAnalyse() {
            const { pib, inflation, opec } = currentData;
            const commonYears = pib.annees.filter(y => 
                inflation.annees.includes(y) && opec.annees.includes(y)
            );

            document.getElementById('content').innerHTML = `
                <div class="info-box">
                    <h2>üî¨ Question 5:Existe-t-il une corr√©lation entre p√©trole, inflation et PIB ?</h2>
                    <p>Analyse des relations entre les indicateurs pour comprendre leur influence mutuelle.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>üîó Ann√©es</h3>
                        <div class="value">${commonYears.length}</div>
                        <div class="subtitle">${commonYears[0]} - ${commonYears[commonYears.length-1]}</div>
                    </div>
                    <div class="stat-card">
                        <h3>üìä Indicateurs</h3>
                        <div class="value">3</div>
                        <div class="subtitle">PIB, Inflation, P√©trole</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìä Comparaison Normalis√©e</h2><p> Les s√©ries sont normalis√©es entre 0 (minimum historique) et 100 (maximum historique) sur la p√©riode 2004‚Äì2024 pour comparer leurs dynamiques.</p>
                    <div class="chart-container">
                        <canvas id="compChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2>üìä Comparaison Normalis√©e</h2><p> Les s√©ries sont normalis√©es entre 0 (minimum historique) et 100 (maximum historique) sur la p√©riode 2004‚Äì2024 pour comparer leurs dynamiques.</p>
                    <div class="chart-container">
                        <canvas><div class="analysis-box">
  <h3>Analyse des corr√©lations observ√©es</h3>

  <p>
    L‚Äôanalyse des s√©ries normalis√©es met en √©vidence des relations significatives
    entre le PIB, l‚Äôinflation et le prix du p√©trole sur la p√©riode 2004‚Äì2024.
  </p>

  <ul>
    <li>
      <strong>PIB et p√©trole :</strong>
      une corr√©lation positive notable est observ√©e. Les phases de hausse et de baisse
      du PIB co√Øncident fr√©quemment avec celles du prix du p√©trole, traduisant une
      d√©pendance √©conomique aux revenus √©nerg√©tiques.
    </li>

    <li>
      <strong>Inflation et p√©trole :</strong>
      l‚Äôinflation tend √† augmenter apr√®s les hausses du prix du p√©trole, avec un
      l√©ger d√©calage temporel, refl√©tant l‚Äôimpact des co√ªts √©nerg√©tiques sur les prix.
    </li>

    <li>
      <strong>Inflation et PIB :</strong>
      la relation est plus instable et d√©pend du contexte √©conomique, avec des p√©riodes
      o√π l‚Äôinflation progresse malgr√© un ralentissement du PIB.
    </li>
  </ul>

  <p class="note">
    ‚ö†Ô∏è Ces observations reposent sur une analyse visuelle. Une √©tude statistique
    (corr√©lation de Pearson, r√©gression) serait n√©cessaire pour confirmer ces relations.
  </p>
</div>
</canvas>
                    </div>
                </div>

                <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <h2 style="margin-bottom: 20px; color: #2c3e50;">üåç Impact des Crises</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>√âv√©nement</th>
                                <th>Ann√©e</th>
                                <th>PIB (%)</th>
                                <th>Inflation (%)</th>
                                <th>P√©trole ($)</th>
                            </tr>
                        </thead>
                        <tbody id="crisisTable"></tbody>
                    </table>
                </div>
            `;

            setTimeout(() => {
                const inflData = commonYears.map(y => inflation.valeurs[inflation.annees.indexOf(y)]);
                const opecData = commonYears.map(y => opec.valeurs[opec.annees.indexOf(y)]);
                const pibData = commonYears.map(y => pib.valeurs[pib.annees.indexOf(y)]);

                createChart('correlChart', {
                    type: 'line',
                    data: {
                        labels: commonYears,
                        datasets: [
                            {
                                label: 'Inflation (%)',
                                data: inflData,
                                borderColor: '#f5576c',
                                yAxisID: 'y',
                                borderWidth: 3,
                                tension: 0.4
                            },
                            {
                                label: 'P√©trole ($/baril)',
                                data: opecData,
                                borderColor: '#43e97b',
                                yAxisID: 'y1',
                                borderWidth: 3,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                position: 'left',
                                title: { display: true, text: 'Inflation (%)' }
                            },
                            y1: {
                                type: 'linear',
                                position: 'right',
                                title: { display: true, text: 'P√©trole ($)' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    }
                });

                createChart('compChart', {
                    type: 'line',
                    data: {
                        labels: commonYears,
                        datasets: [
                            {
                                label: 'PIB (norm.)',
                                data: normalize(pibData),
                                borderColor: '#667eea',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Inflation (norm.)',
                                data: normalize(inflData),
                                borderColor: '#f5576c',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'P√©trole (norm.)',
                                data: normalize(opecData),
                                borderColor: '#43e97b',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                const crises = [
                    { event: 'Crise 2008', year: '2008' },
                    { event: 'Chute P√©trole', year: '2014' },
                    { event: 'COVID-19', year: '2020' },
                    { event: 'Ukraine', year: '2022' }
                ];

                const tbody = document.getElementById('crisisTable');
                crises.forEach(crisis => {
                    if (commonYears.includes(crisis.year)) {
                        const p = pib.valeurs[pib.annees.indexOf(crisis.year)];
                        const i = inflation.valeurs[inflation.annees.indexOf(crisis.year)];
                        const o = opec.valeurs[opec.annees.indexOf(crisis.year)];

                        tbody.innerHTML += `
                            <tr>
                                <td><strong>${crisis.event}</strong></td>
                                <td>${crisis.year}</td>
                                <td class="${p >= 0 ? 'positive' : 'negative'}">${p.toFixed(2)}%</td>
                                <td class="positive">${i.toFixed(2)}%</td>
                                <td>$${o.toFixed(2)}</td>
                            </tr>
                        `;
                    }
                });
            }, 100);
        }

        // ===== INITIALISATION =====
        window.addEventListener('load', async () => {
            console.log('üé¨ Initialisation...');
            
            if (typeof Chart === 'undefined') {
                document.getElementById('loading').innerHTML = '‚ùå Chart.js non charg√©';
                return;
            }

            const success = await loadAllData();
            if (success) {
                loadPage('vue-ensemble');
            } else {
                document.getElementById('loading').innerHTML = 
                    '‚ùå Erreur. V√©rifiez que le backend est lanc√©.';
            }
        });
    </script>
</body>
</html>